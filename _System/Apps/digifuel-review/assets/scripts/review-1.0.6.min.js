function getParameterByName(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=document.referrer.split("?")[1]||"",c=new RegExp("[\\?&]"+a+"=([^&#]*)"),d=c.exec(b);return null==d?"":decodeURIComponent(d[1].replace(/\+/g," "))}function postLoadReviews(){function g(a){$(".form-rating").each(function(){var b=$(this),c=b.text();a>=c?b.addClass("selected"):b.removeClass("selected")})}$(".nav-item-container:not(.sub-nav-items .nav-item-container)","#left-admin-menu");$(".nav-item-warning-message").remove(),$(function(){$("#form-system-field").sortable({items:"li:not(.ui-state-disabled)",placeholder:"ui-state-highlight"})}),$("#form-system-field li").disableSelection();_currentReviewItemsArray=[],_currentReviewRequiredArray=[],_currentReviewVisibleArray=[],_currentAppDetails=[],_currentAppSettings=[],_currentReviewAccessRights=[],_currentReviewSettings=[],$.each(_reviewItems,function(a,b){_currentAppSettings=b,$.each(b,function(a,b){b.weight&&(_currentReviewItemsArray.push(b.weight),_currentReviewRequiredArray.push(b.required),_currentReviewVisibleArray.push(b.visible)),b.weight==catCustomComments&&(catCustomReviewTitleVisible=b.visible),b.weight==catCustomCustomerName&&(catCustomTitleVisible=b.visible),b.appDetails&&(_currentAppDetails=b.appDetails,_reviewName=_currentAppDetails.reviewName,_reviewWebAppName="Review - "+_reviewName,_reviewURL=_currentAppDetails.reviewURL),b.accessRights&&(_currentReviewAccessRights=b.accessRights),b.reviewSettings&&(_currentReviewSettings=b.reviewSettings,_starDefault=_currentReviewSettings.starDefault,_customerTitle=_currentReviewSettings.customerTitle)}),getCustomer()}),$.each(_currentReviewItemsArray,function(a){var b=_currentReviewItemsArray[a];createReview();var c=createReview();0===a&&$("#form-system-field li").slice(1).remove(),$("#form-system-field").append(c[b]);var d=$("#webform-builder #system-fields #a-"+b);d.parent().addClass("used")});var c=$("#form-system-field li:not(:eq(0))");c.each(function(a){var b=_currentReviewRequiredArray[a];b===!0?$(this).find(".req").text("*"):$(this).not("#sortable-1030").find(".req").text("");var c=_currentReviewVisibleArray[a];if(c===!1){var d="";$(this).find(".sortable-item-toggle button:eq(0)").attr("class","sortable-item-eye"+d),$(this).find(".sortable-item-toggle button:eq(0)").attr("title",_invisibleTitle),$(this).find(".sortable-item-toggle button span:eq(0)").attr("class","glyphicon "+_invisibleGlyphiconClass)}});var d=$("#reviewName");d.val(_reviewName);var e=$(".review-url");e.text("http://www.url.com/"+_reviewURL+".html"),"true"==_currentAppSettings.requiresApproval&&$("#requiresApproval").attr("checked",!0),"true"==_currentAppSettings.anonymousReviews&&$("#anonymousReviews").attr("checked",!0),$("#reviewPagination").val(_currentAppSettings.reviewPagination),"true"==_currentAppSettings.altSubmitURL?($("#altSubmitURL").attr("checked",!0),$("#altSubmitURL").next(".hybridFormContainer").show()):$("#altSubmitURL").next(".hybridFormContainer").hide(),$("#altURL").val(_currentAppSettings.altURL);var f=$("#access-rights-container input");$.each(f,function(a){-1!==_currentReviewAccessRights.indexOf($(this).val())&&$(this).attr("checked",!0)}),_rating=_starDefault,g(_rating),$(document).on("click",".form-rating:not(#sortableTable.rgMasterTable .form-rating)",function(){_rating=$(this).text(),g(_rating)}),"MR"!==_customerTitle&&"undefined"!=typeof _customerTitle&&$("#Title option").filter(function(){return"MR"===$(this).text()}).removeAttr("selected"),$("#Title option").filter(function(){return $(this).text()===_customerTitle}).attr("selected","selected"),$(document).on("mouseout mouseover","#form-system-field li",function(){$(this).find(".field-actions").toggle();var a=$(this).find(".sortable-item-toggle button");"hidden"==a.css("visibility")?a.css("visibility","visible"):a.css("visibility","hidden")}),$(document).on("click",".field-actions .edit",function(){confirm("Do you want to change the required option?")&&(""===$(this).closest("li").find(".req").text()?$(this).closest("li").find(".req").text(" *"):$(this).closest("li").find(".req").text(""))}),$(document).on("click",".field-actions .delete",function(){var a=$(this).closest("li").attr("id");a=a.split("-"),a=a[1];var b=$("#webform-builder #system-fields #a-"+a);confirm("Are you sure you wish to delete this item[s]?")&&(b.parent().removeClass("used"),$(this).closest("li").remove())});var h=$("#webform-builder #tabs li");h.unbind("click").click(function(){var a=$(this).attr("id").replace("tab","");a=a.toLowerCase(),$("#system-fields #tabs li").removeClass("active"),$(this).addClass("active"),$("#system-fields ul").not("#tabs").removeClass("active").hide(),$("ul#"+a).addClass("active").show()});var i=$("#webform-builder #system-fields a").not("#tabs a");i.unbind("click").click(function(){var a=$(this).attr("id");a=a.split("-"),a=a[1],createReview();var b=createReview();$(this).parent().hasClass("used")||($("#form-system-field").append(b[a]),$(this).parent().addClass("used"),g(_rating))}),"-1"!==_reviewID&&reviewInsert(),showPageLoadingIndicator(!1),$("#sortableTable.rgMasterTable").length&&(tablePagination(),showPageLoadingIndicator(!0,!0))}function tablePagination(a){var b=new BCAPI.Models.WebApp.ItemCollection(_reviewWebAppName);b.fetch({skip:_currentSkip,limit:_currentLimit,where:_currentWhere,order:"-createDate",success:onReviewListFetch,error:function(a){onAPIError(a)}})}function onReviewListFetch(a,b){$("#sortableTable tr:not(:first-child)").remove(),_totalItemsCount=b.totalItemsCount,_totalItems=b.items,_currentSkip=b.skip,_currentLimit=b.limit,0==_totalItems.length&&showPageLoadingIndicator(!1),0==$("#sortableTable #emptyMessage").length&&$("#sortableTable tbody:first").append('<tr id="emptyMessage"><td colspan="7">There are no reviews with the current filters!</td></tr>'),pageTableInfo(),_.each(a.models,function(b){a.each(function(a){}),_reviewListLength=a.length,b.fetch({success:onReviewListFetchSuccess,error:onAPIError})})}function onReviewListFetchSuccess(a){function m(b){var c=$.ajax({url:"/api/v2/admin/sites/current/webapps/"+_reviewWebAppName+"/items/"+a.get("id"),headers:{Authorization:$.cookie("access_token")},contentType:"application/json"});c.done(function(a){var c=JSON.stringify(a),d=jQuery.parseJSON(c);d=d.enabled,b(d)})}null!=a.get("id")&&$("#sortableTable #emptyMessage").remove();for(var b=a.get("fields").Rating,c=new Object,d=a.get("fields").productQuality,e=new Object,f=a.get("fields").productValue,g=new Object,h=1;6>h;h++)b>=h?c[h]=" selected":c[h]="",d>=h?e[h]=" selected":e[h]="",f>=h?g[h]=" selected":g[h]="";var i="";1==catCustomTitleVisible&&(i=a.get("fields").Title+" ");var j='<td><input type="checkbox" class="selectRow"></td><td>'+i+a.get("fields").CustomerName+"</td>",k="";1==catCustomReviewTitleVisible&&(k=a.get("fields").ReviewTitle+" - ");var l='<tr></tr><tr class="viewReview"><td colspan="7"><strong>Comment: '+k+"</strong>"+a.get("fields").Comments+"</td></tr>";m(function(b){var f,h,d=b;d===!0?(f=' checked="checked"',h=""):(f="",h=" reviewDisabled");var i='<tr></tr><tr class="viewReview"><td colspan="7"><strong>Enable:</strong><input type="checkbox" class="reviewEnable"'+f+'"></td></tr>',k=new Object,m="No";1==a.get("fields").productRecommend&&(m="Yes"),k[catCustomLocation]='<tr></tr><tr class="viewReview"><td colspan="7"><strong>Location: </strong>'+a.get("fields").CustomerLocation+"</td></tr>",k[catCustomProdRecommend]='<tr></tr><tr class="viewReview"><td colspan="7"><strong>Product Recommended: </strong>'+m+"</td></tr>",k[catCustomProdQuality]='<tr></tr><tr class="viewReview"><td colspan="7"><div><strong>Quality: </strong></div><div class="form-rating alt'+e[1]+'">1</div><div class="form-rating alt'+e[2]+'">2</div><div class="form-rating alt'+e[3]+'">3</div><div class="form-rating alt'+e[4]+'">4</div><div class="form-rating alt'+e[5]+'">5</div></td></tr>',k[catCustomProdValue]='<tr></tr><tr class="viewReview"><td colspan="7"><div><strong>Value: </strong></div><div class="form-rating alt'+g[1]+'">1</div><div class="form-rating alt'+g[2]+'">2</div><div class="form-rating alt'+g[3]+'">3</div><div class="form-rating alt'+g[4]+'">4</div><div class="form-rating alt'+g[5]+'">5</div></td></tr>';var n="";$.each(_reviewItems,function(a,b){$.each(b,function(a,b){id=b.weight,n+=k[id]})}),$("#sortableTable tbody:first").append('<tr class="rgRow">'+j+"<td>"+a.get("fields").Email+"</td><td>"+a.get("fields").ReviewName+'</td><td><div class="form-rating'+c[1]+'">1</div><div class="form-rating'+c[2]+'">2</div><div class="form-rating'+c[3]+'">3</div><div class="form-rating'+c[4]+'">4</div><div class="form-rating'+c[5]+'">5</div></td><td>'+a.get("createDate")+'</td><td><a href="#" class="viewReviewBtn '+a.get("id")+h+'">View</a></td>'+l+i+n),$("#sortableTable tbody:first .selectRow:last").attr("id",a.get("id")),$("#sortableTable tbody:first .reviewEnable:last").attr("id",a.get("id")+"-enable"),_reviewListIndex===_reviewListLength&&(showPageLoadingIndicator(!1),_reviewListIndex=0),_reviewListIndex++})}function tryWebAppCreate(a,b){showPageLoadingIndicator(!0,!0),_callAction="create",$.getJSON("_config/reviews_config/"+_reviewID+"/review_webapp.json").done(function(a){createWebApp(_reviewWebAppName,a.reviewCustomFields)}).fail(function(){systemNotifications.showError("Could not load webapp definition file")})}function createWebApp(a,b,c){var d=new BCAPI.Models.WebApp.App({name:_reviewWebAppName,templateId:-1,requiresApproval:$("#requiresApproval").prop("checked"),allowFileUpload:!1,customerCanAdd:!0,customerCanDelete:!1,customerCanEdit:!1,anyoneCanEdit:!1,requiresPayment:!1,validDays:-1,roleId:0,hasAddress:!0,disableDetailPages:!0,locationEnabled:!1});d.save({success:function(a){createCustomFields(a,b,c)},error:function(a,b){onAPIError(a,b)}})}function createCustomFields(a,b,c){var d=_.after(b.length,callAfterAppCreated);_.each(b,function(b){var c=new BCAPI.Models.WebApp.CustomField(a.get("name"),b);c.save({success:d,error:function(a,c){systemNotifications.showError("Failed to create custom field "+b.name)}})})}function callAfterAppCreated(){var a=new BCAPI.Models.WebApp.App({name:_reviewWebAppName});a.fetch({success:function(b,c){_reviewID=a.get("id"),createAppAssets()},error:function(a,b){onAPIError(a,b)}})}function webAppItemEnable(a){var b=new BCAPI.Models.WebApp.Item(_reviewWebAppName,{id:a,enabled:!0});b.save({success:function(a){},error:function(a){onAPIError(a)}})}function webAppItemDisable(a){var b=new BCAPI.Models.WebApp.Item(_reviewWebAppName,{id:a,enabled:!1});b.save({success:function(a){},error:function(a){onAPIError(a)}})}function webAppItemDelete(a,b){var c={rS:b},d=new BCAPI.Models.WebApp.Item(_reviewWebAppName,{id:a});d.destroy({success:function(a,b){1===c.rS&&tablePagination()},error:function(a){onAPIError(a)}})}function createReview(){var a=new Object;return a[1020]='<li id="sortable-1020" class="sys set sortable-comment"><div class="sortableItem"><label for="Review Title">Review Title </label><div class="sortable-item-toggle in-box"><input type="text" name="reviewTitle" id="reviewTitle" class="cat_textbox" maxlength="255"><button type="button" class="sortable-item-eye" title="Visible" id="sortable-1022" style="visibility: hidden;"> <span class="glyphicon glyphicon-eye-open"></span></button></div></div><div class="sortableItem"><label for="CAT_Custom_278423">Comment <span class="req">*</span></label><textarea name="CAT_Custom_278423" id="CAT_Custom_278423" cols="10" rows="4" class="cat_listbox"></textarea></div><div class="field-actions" style="display: none;"><a class="delete" title="Delete ">Delete</a> <a class="edit" title="Edit">Edit</a></div></li>',a[1030]='<li id="sortable-1030" class="sys noact sortable-email"><label for="EmailAddress">Email Address <span class="req">*</span></label><input type="text" name="EmailAddress" id="EmailAddress" class="cat_textbox" maxlength="255"><div class="field-actions" style="display: none;"><span class="mandatory">Mandatory</span></div></li>',a[1040]='<li id="sortable-1040" class="sys set sortable-name"><div class="sortableItem"><label for="Title">Title </label><select name="Title" id="Title" class="cat_dropdown_smaller"><option value="679680">DR</option><option value="679679">MISS</option><option value="679676" selected="selected">MR</option><option value="679677">MRS</option><option value="679678">MS</option></select><div class="sortable-item-toggle"><button type="button" class="sortable-item-eye" title="Visible" id="sortable-1042" style="visibility: hidden;"> <span class="glyphicon glyphicon-eye-open"></span> </button></div></div><div class="sortableItem"><label for="FullName">Name <span class="req">*</span></label><input type="text" name="FullName" id="FullName" class="cat_textbox" maxlength="255"></div><div class="field-actions" style="display: none;"><span class="mandatory">Mandatory</span></div></li>',a[1050]='<li id="sortable-1050" class="sys set sortable-location"><div class="sortableItem"><label for="Location">Location <span class="req"></span> </label><input type="text" name="Location" id="Location" class="cat_textbox" maxlength="255"></div><div class="field-actions"><a class="delete" title="Delete ">Delete</a> <a class="edit" title="Edit">Edit</a></div></li>',a[1060]='<li id="sortable-1060" class="sys set sortable-recommend"><div class="sortableItem"><input type="checkbox" name="prodRecommend" id="prodRecommend">Recommend this product <span class="req"></span></div><div class="field-actions"><a class="delete" title="Delete ">Delete</a></div></li>',a[1070]='<li id="sortable-1070" class="sys set sortable-rating"><div class="sortableItem"><label for="Product Quality">Product Quality <span class="req"></span> </label><div class="form-rating alt none">0</div><div class="form-rating alt selected">1</div><div class="form-rating alt">2</div><div class="form-rating alt">3</div><div class="form-rating alt">4</div><div class="form-rating alt">5</div></div><div class="field-actions"><a class="delete" title="Delete ">Delete</a></div></li>',a[1080]='<li id="sortable-1080" class="sys set sortable-rating"><div class="sortableItem"><label for="Product Value">Product Value <span class="req"></span> </label><div class="form-rating alt none">0</div><div class="form-rating alt selected">1</div><div class="form-rating alt">2</div><div class="form-rating alt">3</div><div class="form-rating alt">4</div><div class="form-rating alt">5</div></div><div class="field-actions"><a class="delete" title="Delete ">Delete</a></div></li>',a}function createWebAppEdit(){for(var a=Math.floor(9e5*Math.random())+1e5,b=new Object,c=1;6>c;c++)_rating>=c?b[c]=" selected":b[c]="";var d=new BCAPI.Models.FileSystem.File("/Layouts/WebApps/"+_reviewWebAppName+"/review_form.tpl"),e='{module_pagename collection="pagename" template=""}{% if origID -%}{% if groupingList -%}{% assign thisID = {{origID}} -%}{% assign thisName = {{origName}} -%}{% endif %}{% elseif id -%}{% assign thisID = {{id}} -%}{% assign thisName = {{name}} -%}{% elseif itemid -%}{% assign thisID = {{itemid}} -%}{% assign thisName = {{name}} -%}{% else %}{% assign thisID = {{globals.get.id}} -%}{% assign thisName = {{pagename.name}} -%}{% endif %}{% capture user_fullname -%}{% if globals.user.fullname != "Anonymous Reviews" -%}value="{{globals.user.fullName}}"{% endif -%}{% endcapture -%}{% if url -%}{% assign thisURL = {{url}} -%}{% else -%}{% assign thisURL = {{globals.get.id}} -%}{% endif %}{% if json_9.appSettings.altSubmitURL == "true" -%}{% assign thisURL = {{json_9.appSettings.altURL}} -%}{% endif %}<div id="reviewForm"><form name="catcustomcontentform'+a+'" onsubmit="return checkWholeForm'+a+'(this)" enctype="multipart/form-data" method="post" action="/CustomContentProcess.aspx?CCID='+_reviewID+'&OID={module_oid}&OTYPE={module_otype}&PageID={{thisURL}}#reviews"><div class="item review-rating"><div class="form-rating'+b[1]+'">1</div><div class="form-rating'+b[2]+'">2</div><div class="form-rating'+b[3]+'">3</div><div class="form-rating'+b[4]+'">4</div><div class="form-rating'+b[5]+'">5</div><div id="yourrating">Select a rating for this Product.</div><div class="rating-select"><input type="text" maxlength="4000" name="CAT_Custom_'+catCustomRating+'" id="CAT_Custom_'+catCustomRating+'" class="cat_textbox ratingSelect" /></div></div>',f=new Object;f[catCustomComments]="if (theForm.CAT_Custom_"+catCustomComments+") why += isEmpty(theForm.CAT_Custom_"+catCustomComments+'.value, "Comment");',f[catCustomEmail]="if (theForm.CAT_Custom_"+catCustomEmail+") why += isEmpty(theForm.CAT_Custom_"+catCustomEmail+'.value, "Email");',f[catCustomCustomerName]="if (theForm.CAT_Custom_"+catCustomCustomerName+") why += isEmpty(theForm.CAT_Custom_"+catCustomCustomerName+'.value, "Customer Name");',f[catCustomLocation]="if (theForm.CAT_Custom_"+catCustomLocation+") why += isEmpty(theForm.CAT_Custom_"+catCustomLocation+'.value, "Location");',f[catCustomProdRecommend]="if (theForm.CAT_Custom_"+catCustomProdRecommend+") why += isEmpty(theForm.CAT_Custom_"+catCustomProdRecommend+'.value, "Product Recommend");',f[catCustomProdQuality]="if (theForm.CAT_Custom_"+catCustomProdQuality+") why += isEmpty(theForm.CAT_Custom_"+catCustomProdQuality+'.value, "Product Quality");',f[catCustomProdValue]="if (theForm.CAT_Custom_"+catCustomProdValue+") why += isEmpty(theForm.CAT_Custom_"+catCustomProdValue+'.value, "Product Value");';var g=$("#form-system-field li:not(:eq(0))"),h="";g.each(function(a){var b=$(this).attr("id");b=b.split("-"),b=b[1];var c=$(this).find(".req").text().length;c>0&&(h+=f[b])}),_reviewOptions.download().done(function(c){_reviewItems=$.parseJSON(c),_currentAppSettings=[],_currentReviewSettings=[],$.each(_reviewItems,function(a,b){_currentAppSettings=b,$.each(b,function(a,b){b.reviewSettings&&(_currentReviewSettings=b.reviewSettings,_starDefault=_currentReviewSettings.starDefault,_customerTitle=_currentReviewSettings.customerTitle)})});var f="";"true"==_currentAppSettings.anonymousReviews&&(f='<div id="anonymousReviews">{% if globals.user.isLoggedIn == "false" -%}0{% elseif globals.user.fullname == "anonymousReviews systemReviewsUser" -%}a{% endif -%}</div>');var g='<div class="hiddenFields"><input type="text" maxlength="4000" name="CAT_Custom_'+catCustomID+'" id="CAT_Custom_'+catCustomID+'" class="cat_textbox" value="{{thisID}}" /><input type="text" maxlength="4000" name="CAT_Custom_'+catCustomName+'" id="CAT_Custom_'+catCustomName+'" class="cat_textbox" value="{{thisName}}" /><input type="text" maxlength="4000" name="CAT_Custom_'+catCustomTotReviews+'" id="CAT_Custom_'+catCustomTotReviews+'" class="cat_textbox totReviews" value="{{newTot}}" /><input type="text" maxlength="4000" name="CAT_Custom_'+catCustomAvgRating+'" id="CAT_Custom_'+catCustomAvgRating+'" class="cat_textbox avgRating" /><input type="text" maxlength="4000" name="CAT_Custom_'+catCustomRealSum+'" id="CAT_Custom_'+catCustomRealSum+'" class="cat_textbox realSum" /><input class="cat_textbox_small" type="text" name="ItemName" id="ItemName" maxlength="255" />'+f+'</div><input class="cat_button" type="submit" value="Submit" id="catcustomcontentbutton"/><script type="text/javascript" src="/CatalystScripts/ValidationFunctions.js"></script><script type="text/javascript">//<![CDATA[\nvar submitcount'+a+" = 0;function checkWholeForm"+a+'(theForm){var why = "";if (theForm.ItemName) why += isEmpty(theForm.ItemName.value, "Item Name");'+h+"if (theForm.CAT_Custom_"+catCustomRating+") why += checkDropdown(theForm.CAT_Custom_"+catCustomRating+'.value, "a Rating");if (why != ""){alert(why);return false;}if(submitcount'+a+" == 0){submitcount"+a+'++;setTimeout(function(){theForm.submit();},500);return false;}else{alert("Form submission is in progress.");return false;}}//]]>\n</script></form></div>',i=_customerTitle,j=' selected="selected"',k="",l="",m="",n="",o="",p="";"-- Please select --"==i?k=j:"DR"==i?l=j:"MR"==i?m=j:"MRS"==i?n=j:"MS"==i?o=j:"MISS"==i&&(p=j);var q=new Object;q[catCustomReviewTitle]='<div class="item"><label for="ItemDescription">Title</label><input type="text" maxlength="4000" name="CAT_Custom_'+catCustomReviewTitle+'" id="CAT_Custom_'+catCustomReviewTitle+'" class="cat_textbox" /></div>',q[catCustomComments]='<div class="item"><label for="CAT_Custom_'+catCustomComments+'">Your Review</label><textarea name="CAT_Custom_'+catCustomComments+'" id="CAT_Custom_'+catCustomComments+'" cols="10" rows="4" class="cat_listbox" onkeydown="if(this.value.length>=4000)this.value=this.value.substring(0,3999);"></textarea></div>',q[catCustomEmail]='<div class="item"><label for="CAT_Custom_'+catCustomEmail+'">Email Address</label><input type="text" maxlength="4000" name="CAT_Custom_'+catCustomEmail+'" id="CAT_Custom_'+catCustomEmail+'" class="cat_textbox" /></div>',q[catCustomTitle]='<div class="item title"><label for="CAT_Custom_'+catCustomTitle+'">Title</label><select name="CAT_Custom_'+catCustomTitle+'" id="CAT_Custom_'+catCustomTitle+'" class="cat_dropdown"><option value=" ">-- Please select --</option><option value="Dr"'+l+'>Dr</option><option value="Miss"'+p+'>Miss</option><option value="Mr"'+m+'>Mr</option><option value="Mrs"'+n+'>Mrs</option><option value="Ms"'+o+">Ms</option></select></div>",q[catCustomCustomerName]='<div class="item"><label for="CAT_Custom_'+catCustomCustomerName+'">Name</label><input type="text" maxlength="4000" name="CAT_Custom_'+catCustomCustomerName+'" id="CAT_Custom_'+catCustomCustomerName+'" class="cat_textbox customerName" {{user_fullname}}/></div>',q[catCustomLocation]='<div class="item"><label for="CAT_Custom_'+catCustomLocation+'">Location</label><input type="text" maxlength="4000" name="CAT_Custom_'+catCustomLocation+'" id="CAT_Custom_'+catCustomLocation+'" class="cat_textbox"/></div>',q[catCustomProdRecommend]='<div class="item checkbox"><label for="CAT_Custom_'+catCustomProdRecommend+'">Recommend this Product</label><input type="checkbox" name="CAT_Custom_'+catCustomProdRecommend+'" id="CAT_Custom_'+catCustomProdRecommend+'" value="1" /></div>',q[catCustomProdQuality]='<div class="item item-rating"><label for="CAT_Custom_'+catCustomProdQuality+'">Product Quality</label><div class="form-rating alt'+b[1]+'">1</div><div class="form-rating alt'+b[2]+'">2</div><div class="form-rating alt'+b[3]+'">3</div><div class="form-rating alt'+b[4]+'">4</div><div class="form-rating alt'+b[5]+'">5</div><div class="rating-select"><input type="text" maxlength="4000" name="CAT_Custom_'+catCustomProdQuality+'" id="CAT_Custom_'+catCustomProdQuality+'" class="cat_textbox ratingSelect" /></div></div>',q[catCustomProdValue]='<div class="item item-rating"><label for="CAT_Custom_'+catCustomProdValue+'">Product Value</label><div class="form-rating alt'+b[1]+'">1</div><div class="form-rating alt'+b[2]+'">2</div><div class="form-rating alt'+b[3]+'">3</div><div class="form-rating alt'+b[4]+'">4</div><div class="form-rating alt'+b[5]+'">5</div><div class="rating-select"><input type="text" maxlength="4000" name="CAT_Custom_'+catCustomProdValue+'" id="CAT_Custom_'+catCustomProdValue+'" class="cat_textbox ratingSelect" /></div></div>';var r=$("#form-system-field li:not(:eq(0))"),s="",t="";r.each(function(a){var b=$(this).attr("id");b=b.split("-"),b=b[1],$(this).find(".sortable-item-eye .glyphicon.glyphicon-eye-open").length>0?(A=$(this).find(".sortable-item-eye").attr("id"),A=A.split("-"),A=A[1],t=q[A]):t="",s=s+t+q[b]});var q=e+s+g;d.upload(q).done(function(){reviewInsert(),callsCompleted()}).error(function(a){onAPIError(a)});var u=new BCAPI.Models.FileSystem.File("/Layouts/WebApps/"+_reviewWebAppName+"/review_list.tpl"),v='<div class="review-item"><div class="review"><div class="starRatings">Rating: {{reviewItem.rating}}<div class="rating star{{reviewItem.rating}}"></div><div class="rating noStar{{reviewItem.rating}}"></div></div>',w=new Object;w[catCustomReviewTitle]='{% if reviewItem.reviewtitle != "" -%}<div class="item title"><span>Title </span>{{reviewItem.reviewtitle}}</div>{% endif %}',w[catCustomComments]='{% if reviewItem.comments -%}<div class="item comment"><span>Comment </span>{{reviewItem.comments}}</div>{% endif %}',w[catCustomEmail]="",w[catCustomTitle]="",w[catCustomCustomerName]='<div class="item name"><span>Name </span>{{reviewItem.customername}}</div>',w[catCustomLocation]='{% if reviewItem.customerlocation != "" -%}<div class="item location"><span>Location </span>{{reviewItem.customerlocation}}</div>{% endif %}',w[catCustomProdRecommend]='{% if reviewItem.productrecommend == "1" -%}<div class="item checkbox recommend"><span>Product Recommended </span></div>{% endif -%}',w[catCustomProdQuality]='<div class="altRatings productQuality"><span>Product Quality </span>Rating: {{reviewItem.productquality}}<div class="rating star{{reviewItem.productquality}}"></div><div class="rating noStar{{reviewItem.productquality}}"></div></div>',w[catCustomProdValue]='<div class="altRatings productValue"><span>Product Value </span>Rating: {{reviewItem.productvalue}}<div class="rating star{{reviewItem.productvalue}}"></div><div class="rating noStar{{reviewItem.productvalue}}"></div></div>';var x,y,A,z="",B="";r.each(function(a){var b=$(this).attr("id");b=b.split("-"),b=b[1],$(this).find(".sortable-item-eye .glyphicon.glyphicon-eye-open").length>0?(A=$(this).find(".sortable-item-eye").attr("id"),A=A.split("-"),A=A[1],B=w[A]):B="",z=z+B+w[b],"1042"===A&&(y=!0)}),x=1==y?'<span class="custName">{{reviewItem.title}} {{reviewItem.customername}}</span>':'<span class="custName">{{reviewItem.customername}}</span>';var C='</div><!--END REVIEW--><div class="review-meta">'+x+' - {{reviewItem.releasedate | date: "dd-MMM-yyyy"}}</div></div><!--END REVIEW ITEM-->',w=v+z+C;u.upload(w).done(function(){callsCompleted()}).error(function(a){onAPIError(a)})})}function createWebAppList(){var a=new BCAPI.Models.FileSystem.File("/Layouts/WebApps/"+_reviewWebAppName+"/review_rating.tpl"),b='{% if {{reviewRating_length}} < 500 -%}{% assign reviewRating_rating = reviewRating_total | divided_by: reviewRating_length -%}<div class="ratingContainer"><div class="rating star{{reviewRating_rating|round}}"></div><div class="rating noStar{{reviewRating_rating|round}}"></div><span class="average">{{reviewRating_rating|round:1|number:"F1"}}</span> out of <span class="best">5</span> based on <span data-sum="{{reviewRating_total|round}}" class="votes">{{reviewRating_length}}</span>{% if {{reviewRating_length}} <= 1 -%} review.{% else %} reviews.{% endif %}</div>{% else %}<div class="ratingContainer"><div class="rating star{{reviewRating.avgrating}}"></div><div class="rating noStar{{reviewRating.avgrating}}"></div><span class="average">{{reviewRating.avgrating}}</span> out of <span class="best">5</span> based on <span data-sum="{{reviewRating.realsum}}" class="votes">{{reviewRating.totreviews}}</span>{% if {{reviewRating.totreviews}} <= 1 -%} review.{% else %} reviews.{% endif %}</div>{% endif %}';a.upload(b).done(function(){callsCompleted()}).error(function(a){onAPIError(a)})}function helpPopup(){$(".helpLabel").hover(function(){$(this).next(".helpHandle").stop(!0,!0).show(0)},function(){$(this).next(".helpHandle").stop(!0,!0).delay(250).fadeOut(250)}),$(".helpHandle").hover(function(){var a=$(this).data("helpinfo");$("#hybridHelp").text(a);var b=$(this).position(),c=$(this).outerWidth();$("#hybridHelp").css({display:"block",opacity:.8,top:b.top-5+"px",left:(b.left+c)/3+"px"}).stop(!0,!0).show(0),$(this).next(".helpHandle").stop(!0,!0).delay(100).fadeOut(150)}),$("#hybridHelp").mouseout(function(){$(this).stop(!0,!0).delay(100).fadeOut(250)})}function loadReviews(){_menuFile.download().done(function(a){_currentMenuItems=$.parseJSON(a)}),"-1"!==_reviewID?($("#reviewName,#requiresApproval").prop("disabled",!0),$("#reviewName,#requiresApproval").addClass("disable-cursor"),$("#app-details-container").hide(),$("#app-settings-container").hide(),"y"===window.localStorage.getItem("UpdateCode")):($('.hybridFormExpand:not(".app-help .hybridFormExpand")').toggleClass("hybridFormExpand hybridFormContract"),$("#review-code-container").parent().hide(),$(".save").html("Create Review"),$(".editWebApp").hide(),$("#tab-reviews").addClass("tab-disabled"),$("#tab-reviews").unbind("click").click(function(a){event.preventDefault()})),$(".hybridFormTitlewrap").unbind("click").click(function(){$(this).parent().next().toggle(200),$(this).parent(".hybridFormExpand, .hybridFormContract").toggleClass("hybridFormExpand hybridFormContract")}),$("#altSubmitURL").unbind("click").click(function(){$(this).next(".hybridFormContainer").toggle(200)}),_reviewOptions.download().done(function(a){_reviewItems=$.parseJSON(a),$("#help-pg").length||(postLoadReviews(),$("#edit-pg").length&&(setVisibility(),setUrlEdit(),bug101Menu()),$("#reviews-pg").length&&(reviewEnable(),webAppItemSearch(),viewReview(),pageSizeComboBox(),sortableTableBulkAction(),sortableTableBulkCheck(),webAppFilters(),webAppDatePicker(),pageNavABC(),setTablePageNext(),setTablePagePrev(),setTablePageFirst(),setTablePageLast()),helpPopup())})}function bug101Menu(a){var b=document.getElementsByTagName("script"),c=b[b.length-1],d=c.src,e="https://digifuel-review-2104505-apps.worldsecuresystems.com/_System/Apps/digifuel-review/assets/scripts/review-1.0.4.min.js";d===e&&_menuFile.download().done(function(a){var b='{"menu-reviews":{"weight":200000,"icon":"/_config/icon.png","title":"Review"},"menu-add_reviews_app":{"parent":"menu-reviews","weight":10000,"title":"+ Add Review App","attr":{"href":"/Admin/AppLoader.aspx?client_id=digifuel-review&redirect_uri=edit.html&reviewID=-1"}}}';a.replace(b,"");a===b&&bug101MenuReplace()})}function bug101MenuReplace(){var d,a=new BCAPI.Models.WebApp.AppCollection,b=!1,c=0,e="";a.fetch().done(function(){if(a.each(function(a){var i,f=a.get("id"),g=a.get("name"),h="Review - ";-1!==g.indexOf(h)&&(b=!0,c+=10,g=g.replace(h,""),i=g,g=g.toLowerCase(),g=g.replace(/ /g,"_"),d=',"menu-'+g+'":{"parent":"menu-reviews","weight":'+c+',"title":"'+i+'","attr":{"href":"/Admin/AppLoader.aspx?client_id=digifuel-review&reviewID='+f+'"}},"menu-webapp-review_-_'+g+'":{"visible":false}',e+=d)}),1==b){var f='{"menu-reviews":{"weight":200000,"icon":"/_config/icon.png","title":"Review"},"menu-add_reviews_app":{"parent":"menu-reviews","weight":10000,"title":"+ Add Review App","attr":{"href":"/Admin/AppLoader.aspx?client_id=digifuel-review&redirect_uri=edit.html&reviewID=-1"}}',g="}",h=f+e+g;_menuFile.upload(h).done(function(){})}}).fail(function(a){console.log("Request failed to update bug101 Menu Visibility issue.")})}function setVisibility(){$(document).on("click",".sortable-item-toggle button",function(){var a=$(this).find("span");a.hasClass(_visibleGlyphiconClass)?(a.removeClass(_visibleGlyphiconClass),a.addClass(_invisibleGlyphiconClass),$(this).attr("title",_invisibleTitle)):(a.removeClass(_invisibleGlyphiconClass),a.addClass(_visibleGlyphiconClass),$(this).attr("title",_visibleTitle))})}function setUrlEdit(){$("#editButton").unbind("click").click(function(){var a=$(this).siblings("p"),b=$(this).siblings("input");$(a).toggle(),$(b).toggle()})}function reviewEnable(){$(document).on("change",".reviewEnable",function(){var a=$(this).attr("id");a=a.split("-"),$(this).is(":checked")?(webAppItemEnable(a[0]),$("td a.viewReviewBtn."+a[0]).removeClass("reviewDisabled")):(webAppItemDisable(a[0]),$("td a.viewReviewBtn."+a[0]).addClass("reviewDisabled"))})}function reviewInsert(){var a=_reviewWebAppName.split(" - "),b=a[1],c=$("#reviewsCollection");c.val('{% assign Review="'+b+"-"+_reviewID+'" -%}{% include"/_System/apps/digifuel-review/public/reviews.inc" -%}');var d=$("#reviewStarBar");d.val("{{Rating_Bar}}");var e=$("#reviewsList");e.val("{{Reviews_List}}");var f=$("#reviewEdit");f.val("{{Review_Form}}")}function webAppFilters(){$("#filtersTrigger").unbind("click").click(function(a){a.preventDefault(),a.stopPropagation(),$("#hybridFilters").css({left:"20px",top:"95px"}),$("#hybridFilters").toggle(),$(document).on("click",function(a){0===$("#hybridFilters").has(a.target).length&&0===$(".ui-daterangepickercontain").has(a.target).length&&$("#hybridFilters").hide();
})})}function webAppDatePicker(){$(".ui-daterangepickercontain li").unbind("hover").hover(function(a){$(".ui-daterangepickercontain li").removeClass("ui-state-hover"),$(this).addClass("ui-state-hover")}),$(".dropdown-date-button").unbind("click").click(function(a){$(this).addClass("ui-state-active"),a.preventDefault(),a.stopPropagation(),$(".ui-daterangepickercontain").css({left:"197px",top:"135px"}),$(".ui-daterangepickercontain").toggle(),$(".ui-daterangepickercontain li").unbind("click").click(function(a){$(".ui-daterangepickercontain li").removeClass("ui-state-active"),$(this).addClass("ui-state-active"),$("#filtersText span").html("<strong>Date Period</strong>: "+$(this).text());var b=$(this).children().attr("class");if("ALL"!==b){_startMonth=b.substr(1,1),_startDay=b.substr(0,1),_startYear=b.substr(2,1);var c=date(_startMonth,_startDay,_startYear),d=date(_startMonth=0,_startDay=0,_startYear=0);_currentWhere={createDate:{$gte:c,$lte:d}},tablePagination(),showPageLoadingIndicator(!0,!0),$(".ui-daterangepickercontain").hide(),$("#hybridFilters").hide()}else _currentWhere={},tablePagination(),showPageLoadingIndicator(!0,!0),$(".ui-daterangepickercontain").hide(),$("#hybridFilters").hide()}),$(document).on("click",function(a){0===$(".ui-daterangepickercontain").has(a.target).length&&$(".ui-daterangepickercontain").hide()})})}function date(a,b,c){var d=new Date;d.setMonth(d.getMonth()-a),d.setDate(d.getDate()-b),d.setFullYear(d.getFullYear()-c);var e=d.getMonth()+1,f=d.getDate(),g=d.getFullYear(),h=g+"-"+((""+e).length<2?"0":"")+e+"-"+((""+f).length<2?"0":"")+f;return h}function webAppItemSearch(){$("#webAppItemsSearch").keypress(function(a){if(13==a.which){var b=$(this).val();_currentWhere={name:{$contains:b}},tablePagination(),showPageLoadingIndicator(!0,!0)}})}function pageNavABC(){$(".page-navigation a").unbind("click").click(function(){var a=$(this).text();"ALL"==a?($(".page-navigation a").removeClass("selected"),$(this).addClass("selected"),_currentWhere={},tablePagination(),showPageLoadingIndicator(!0,!0)):($(".page-navigation a").removeClass("selected"),$(this).addClass("selected"),_currentWhere={name:{$beginsWith:a}},tablePagination(),showPageLoadingIndicator(!0,!0))})}function setTablePageNext(){$(".rgPageNext").unbind("click").click(function(){if(parseInt(_currentLimit)<parseInt(_totalItemsCount)){var a=$("#PageSizeComboBox_Input").val();_currentSkip=parseInt(_currentSkip)+parseInt(a),_currentLimit=parseInt(_currentLimit)+parseInt(a),tablePagination(),showPageLoadingIndicator(!0,!0)}})}function setTablePagePrev(){$(".rgPagePrev").unbind("click").click(function(){if(0!=parseInt(_currentSkip)){var a=$("#PageSizeComboBox_Input").val();_currentSkip=parseInt(_currentSkip)-parseInt(a),_currentLimit=parseInt(_currentLimit)-parseInt(a),0>_currentSkip&&(_currentSkip=0,_currentLimit=parseInt(a)),tablePagination(),showPageLoadingIndicator(!0,!0)}})}function setTablePageFirst(){$(".rgPageFirst").unbind("click").click(function(){if(0!=parseInt(_currentSkip)){var a=$("#PageSizeComboBox_Input").val();_currentSkip=0,_currentLimit=parseInt(a),tablePagination(),showPageLoadingIndicator(!0,!0)}})}function setTablePageLast(){$(".rgPageLast").unbind("click").click(function(){if(parseInt(_currentLimit)<parseInt(_totalItemsCount)){var a=$("#PageSizeComboBox_Input").val();_currentSkip=parseFloat(Math.ceil(parseInt(_totalItemsCount)/parseInt(a)))*parseInt(a)-parseInt(a),_currentLimit=parseFloat(Math.ceil(parseInt(_totalItemsCount)/parseInt(a)))*parseInt(a),tablePagination(),showPageLoadingIndicator(!0,!0)}})}function pageSizeComboBox(){$("#pageSizeComboBox").unbind("click").click(function(a){a.preventDefault(),a.stopPropagation(),$(".rcbSlide").toggle(200),$(this).toggleClass("active"),$(".rcbItem").unbind("click").click(function(){var a=$(this).text();$("#PageSizeComboBox_Input").val(a),_currentSkip=parseInt(_currentSkip),_currentLimit=parseInt(_currentSkip)+parseInt(a),tablePagination(),showPageLoadingIndicator(!0,!0)}),$(document).on("click",function(a){0===$(".rcbSlide").has(a.target).length&&$(".rcbSlide").hide()})})}function pageTableInfo(){var a=$("#PageSizeComboBox_Input").val(),b=_totalItems.length,c=parseInt(_currentLimit)/(parseInt(_currentLimit)-parseInt(_currentSkip)),d=parseInt(_totalItemsCount)/parseInt(a);d=parseFloat(Math.ceil(d));var e=parseInt(_currentSkip)+1,f=parseInt(_currentSkip)+b;$("#currentPage").text(c),$("#totalPages").text(d),$("#currentItems").text(e+" to "+f),$("#totalItems").text(_totalItemsCount)}function sortableTableBulkAction(){$("#bulkActions .delete").unbind("click").click(function(){var a=$("#sortableTable .rgRow input.selectRow"),b=0;$.each(a,function(a){if($(this).is(":checked")){var c=$(this).attr("id");b+=1,webAppItemDelete(c,b)}})})}function sortableTableBulkCheck(){$(".selectAllRows").change(function(){var a=$("#sortableTable .rgRow input.selectRow");$(this).is(":checked")?$.each(a,function(a){$(this).prop("checked",!0)}):$.each(a,function(a){$(this).prop("checked",!1)})})}function viewReview(){$(document).on("click",".viewReviewBtn",function(){$(this).closest(".rgRow").next().nextUntil(".rgRow",".viewReview").toggle(200),"View"===$(this).text()?$(this).text("Hide"):$(this).text("View")})}function saveCreate(){if(_reviewName=$("input[name='reviewName']").val(),_reviewWebAppName="Review - "+_reviewName,""===_reviewName)return void alert("Please choose a name.");var a=new BCAPI.Models.WebApp.App({name:_reviewWebAppName});a.fetch({success:function(a,b){"-1"===_reviewID?alert("Review already exists. Please choose a different name."):(_callAction="save",saveChanges(_callAction),showPageLoadingIndicator(!0,!0))},error:tryWebAppCreate})}function createAppAssets(){function d(a,b){var c=new BCAPI.Models.FileSystem.File("/_System/Apps/digifuel-review/_config/reviews_config/"+_reviewID+"/"+b),d=a;c.upload(d).done(function(){_i++,_i>1&&saveChanges(),callsCompleted()}).error(function(a){onAPIError(a)})}var a=new BCAPI.Models.FileSystem.Folder("/_System/Apps/digifuel-review/_config/reviews_config/"+_reviewID);a.create().done(function(){callsCompleted()});var b=BCAPI.Models.FileSystem.Root.file("/_System/Apps/digifuel-review/_config/reviews_config/-1/review_options.json");b.download().done(function(a){d(a,"review_options.json")}).error(function(a){onAPIError(a)});var c=BCAPI.Models.FileSystem.Root.file("/_System/Apps/digifuel-review/_config/reviews_config/-1/review_webapp.json");c.download().done(function(a){d(a,"review_webapp.json")}).error(function(a){onAPIError(a)});var i,f=($("#accessRightsForm").find('input[type="checkbox"]:checked'),_reviewName.replace(/ /g,"_").replace(/[^a-z0-9 _]/gi,"")),g=f.toLowerCase(),h=_reviewName.replace(/ /g,"_").replace(/[^a-z0-9 _]/gi,"").replace(/_/g," "),j="menu-"+g,k="menu-webapp-review_-_"+g;$.each(_currentMenuItems,function(a,b){var c=parseInt(b.weight);1e4===c&&(c=0),isNaN(c)||(i=c+10)}),_currentMenuItems[j]={},_currentMenuItems[j].parent="menu-reviews",_currentMenuItems[j].weight=i,_currentMenuItems[j].title=h,_currentMenuItems[j].attr={},_currentMenuItems[j].attr.href="/Admin/AppLoader.aspx?client_id=digifuel-review&reviewID="+_reviewID,_currentMenuItems[k]={},_currentMenuItems[k].visible=!1;var l=JSON.stringify(_currentMenuItems);_menuFileCopy.upload(l).done(function(){}),_menuFile.upload(l).done(function(){try{window.parent.location.reload()}catch(a){callsCompleted()}})}function addCustomFields(){_currentCustomFields[currentProperty]={},_currentCustomFields[currentProperty].id=customFieldID,_currentCustomFields[currentProperty].name=customFieldName,_currentCustomFields[currentProperty].type=customFieldType,_currentCustomFields[currentProperty].required=customFieldRequired;var a=JSON.stringify(__currentCustomFields);_reviewWebApp.upload(a).done(function(){try{window.parent.location.reload()}catch(a){callsCompleted()}})}function saveChanges(a){var b=[],c=$("#form-system-field").sortable("toArray"),d=$("#form-system-field li:not(:eq(0))");$.each(d,function(a){var d=c[a].split("-"),e=$(this).attr("class");d=d[1];var f=$(this).find(".req").text().length;f=f>0?!0:!1;var g=$(this).find(".sortable-item-toggle button span:eq(0)").hasClass(_invisibleGlyphiconClass)===!1,h={itemname:e,weight:d,required:f,visible:g};b.push(h)});var e=$("#app-details-container .hybridFormContainer input[name='reviewName']"),f=$("#app-details-container .hybridFormContainer input[name='reviewURL']"),g=e.val(),h=f.val(),i={appDetails:{reviewName:g,reviewURL:h}};b.push(i);var j={},k=$("#app-settings-container input");k.each(function(a){if($(this).is(":checkbox"))if($(this).is(":checked")){var b=$(this).val();j[b]="true"}else{var b=$(this).val();j[b]="false"}else{var b=$(this).attr("name");j[b]=$(this).val()}});var l=j,m=" ",n=[],o=$("#access-rights-container input");$.each(o,function(a){$(this).is(":checked")&&(m=$(this).val(),n.push(m))});var p={accessRights:n};b.push(p);var q=$("#Title :selected").text(),r={reviewSettings:{starDefault:_rating,customerTitle:q}};b.push(r),c=JSON.stringify({reviews:b,appSettings:l},null,2),_reviewOptions=BCAPI.Models.FileSystem.Root.file("/_System/Apps/digifuel-review/_config/reviews_config/"+_reviewID+"/review_options.json"),_reviewOptions.upload(c).done(function(){try{window.parent.location.reload()}catch(a){createWebAppEdit(),createWebAppList()}}),_reviewOptionsPublic.upload(c)}function deleteWebApp(){if(_callAction="delete","-1"!==_reviewID&&confirm("Are you sure you want to delete this customer review permanently?")){var a=new BCAPI.Models.WebApp.App({name:_reviewWebAppName});a.destroy({success:function(a,b){deleteWebAppFolder()},error:function(a,b,c){deleteWebAppFolder()}});var b=new BCAPI.Models.FileSystem.Folder("/_System/Apps/digifuel-review/_config/reviews_config/"+_reviewID);b.destroy().done(function(){callsCompleted()}),deleteMenuItem()}}function deleteWebAppFolder(){var a=new BCAPI.Models.FileSystem.Folder("/Layouts/WebApps/"+_reviewWebAppName);a.destroy().done(function(){callsCompleted()})}function editWebApp(){var a=_refGet.split("/Admin")[0];window.parent.location.href=a+"/Admin/CustomContent_ItemList.aspx?CustomContentID="+_reviewID+"&t=t&CustomContent=Review+-+"+_reviewName}function deleteMenuItem(){showPageLoadingIndicator(!0,!0);var a=_reviewName.replace(/ /g,"_").replace(/[^a-z0-9 _]/gi,""),b="menu-"+a;b=b.toLowerCase();var c="menu-webapp-review_-_"+a;c=c.toLowerCase(),$.each(_currentMenuItems,function(a){(a===b||a===c)&&delete _currentMenuItems[a]});var d=JSON.stringify(_currentMenuItems);_menuFileCopy.upload(d).done(function(){}),_menuFile.upload(d).done(function(){try{window.parent.location.reload()}catch(a){callsCompleted()}})}function getCustomer(){var a=$.ajax({url:'/webresources/api/v3/sites/current/customers?fields=email1,middleName,firstName,lastName&where={"username":"anonymousReviews"}',type:"GET",conenection:"keep-alive",contentType:"application/json",mimeType:"applicaiton/json ",headers:{Authorization:$.cookie("access_token")}});a.done(function(a){0==a.items.length&&createCustomer()}),a.fail(function(a){onAPIError(a)})}function createCustomer(){var a=$.ajax({url:"/webresources/api/v3/sites/current/customers",type:"POST",conenection:"keep-alive",contentType:"application/json",mimeType:"applicaiton/json ",processData:!1,headers:{Authorization:$.cookie("access_token")},data:JSON.stringify({firstName:"Anonymous",lastName:"Reviews",username:"anonymousReviews",email1:{value:"anonymousreviews@anonymousreviews.none","default":!0}})});a.done(function(a){}),a.fail(function(a){onAPIError(a)})}function onAPIError(a,b,c){showPageLoadingIndicator(!1),showErrorMessage(b,"API Error")}function showErrorMessage(a,b){var c="Unknown error.";a.responseText&&(c="Server error. Error code: "+JSON.parse(a.responseText).code),systemNotifications.showError(void 0!=typeof b?b:"Error",c)}function onReviewSuccess(){showPageLoadingIndicator(!1),systemNotifications.showSuccess("Save successful","Update Highlighted Review Form Code in your HTML"),setTimeout(function(){},3e3)}function callsCompleted(){_i++,"create"===_callAction&&7===_i&&(_i=0,window.parent.location.href=_refGet+"?client_id=digifuel-review&reviewID="+_reviewID),"delete"===_callAction&&3===_i&&(_i=0,window.parent.location.href=_refGet+"?client_id=digifuel-review&reviewID=-1"),"save"===_callAction&&2===_i&&(_i=0,onReviewSuccess())}function showPageLoadingIndicator(a,b){a?($(".loading").show(),b?$(".loading").addClass("semiopaque"):$(".loading").removeClass("semiopaque")):$(".loading").hide()}var _menuFile=BCAPI.Models.FileSystem.Root.file("/_System/Apps/digifuel-review/_config/menu.json"),_menuFileCopy=BCAPI.Models.FileSystem.Root.file("/_System/Apps/digifuel-review/_config/menuCopy.json"),_visibleGlyphiconClass="glyphicon-eye-open",_invisibleGlyphiconClass="glyphicon-eye-close",_invisibleTitle="Disabled - Hidden from users",_visibleTitle="Enabled - Visible to users",_refGet,_currentMenuItems,_reviewItems,_currentMenuItemsArray,_currentReviewItemsArray,_currentReviewVisibleArray,_reviewName,_reviewPagination,_altURL,_reviewWebAppName,_reviewURL,_starDefault,_customerTitle,_currentWhere={},_currentSkip=0,_currentLimit=10,_totalItemsCount=0,_totalItems=0,_startMonth=0,_startDay=0,_startYear=0,_reviewListIndex=1,_reviewListLength,_callAction,_rating=1,_i=0,catCustomID=10,catCustomName=20,catCustomTotReviews=200,catCustomAvgRating=210,catCustomRealSum=220,catCustomRating=1e3,catCustomReviewTitle=1022,catCustomReviewTitleVisible,catCustomComments=1020,catCustomEmail=1030,catCustomTitle=1042,catCustomTitleVisible,catCustomCustomerName=1040,catCustomLocation=1050,catCustomProdRecommend=1060,catCustomProdQuality=1070,catCustomProdValue=1080;if(getParameterByName("reviewID")){var _reviewID=getParameterByName("reviewID");window.sessionStorage.setItem("reviewID",_reviewID),window.sessionStorage.setItem("reviewURL",document.referrer.split("?")[0]);var _refGet=window.sessionStorage.getItem("reviewURL")}else if(0===window.sessionStorage.getItem("reviewID").length)alert("To use this Review app incognito mode must be disabled in your browser"),window.parent.location.href=_refGet+"?client_id=digifuel-review&reviewID=-1";else var _reviewID=window.sessionStorage.getItem("reviewID"),_refGet=window.sessionStorage.getItem("reviewURL");var _reviewAppIndex=BCAPI.Models.FileSystem.Root.file("/_System/Apps/digifuel-review/"+_reviewID+".html"),_reviewOptions=BCAPI.Models.FileSystem.Root.file("/_System/Apps/digifuel-review/_config/reviews_config/"+_reviewID+"/review_options.json"),_reviewWebApp=BCAPI.Models.FileSystem.Root.file("/_System/Apps/digifuel-review/_config/reviews_config/"+_reviewID+"/review_webapp.json"),_reviewOptionsPublic=BCAPI.Models.FileSystem.Root.file("/_System/Apps/digifuel-review/public/reviews_config/"+_reviewID+"/review_options.json");$(function(){"use strict";showPageLoadingIndicator(!0),$("button.save").click(function(){saveCreate()}),$("button.delete").click(function(){deleteWebApp()}),$("button.editWebApp").click(function(){editWebApp()}),$.ajax({dataType:"json",url:"/api/v2/admin/sites/"+BCAPI.Helper.Site.getSiteId()+"/roles",beforeSend:function(a){a.setRequestHeader("Authorization",BCAPI.Helper.Site.getAccessToken())},success:function(a){$.each(a.items,function(a,b){$("#access-rights-container").find(".controls").append('<label><input type = "checkbox" value="'+b.name+'">'+b.name+"</input></label>")})}}),loadReviews()});